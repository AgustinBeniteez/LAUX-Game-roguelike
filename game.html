<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>LAUX GAME</title>
  <div id="version-display" style="position: fixed; bottom: 10px; left: 10px; color: rgba(255, 255, 255, 0.7); font-family: 'Mineglyph', sans-serif; font-size: 14px;"></div>
  <script type="module">
    import { VERSION } from './version.js';
    document.getElementById('version-display').textContent = VERSION;
  </script>
  <link rel="shortcut icon" href="sprites/laux_logo.webp" type="image/x-icon">
  <link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css' rel='stylesheet'/>
  <link rel="stylesheet" href="custom_cursor.css">
  <link rel="stylesheet" href="src/fonts.css">
  <script src="devMenu.js"></script>
  <script>
    // Load saved language
    const currentLang = localStorage.getItem('language') || 'es';
    document.documentElement.lang = currentLang;

    // Sistema de apuntado y habilidades
    let isAimingE = false;
    let isAimingR = false;
    let aimIndicator = null;
    let lastECastTime = 0;
    let lastRCastTime = 0;

    document.addEventListener('keydown', (e) => {
      const playerData = JSON.parse(localStorage.getItem('playerData'));
      const abilities = playerData?.abilities;
      if (!abilities) return;

      if (e.key.toLowerCase() === 'e' && !isAimingE) {
        const currentTime = Date.now();
        if (currentTime - lastECastTime >= abilities[0].cooldown * 1000) {
          isAimingE = true;
          showAimIndicator();
        }
      } else if (e.key.toLowerCase() === 'r' && !isAimingR) {
        const currentTime = Date.now();
        if (currentTime - lastRCastTime >= abilities[1].cooldown * 1000) {
          isAimingR = true;
          showAimIndicator();
        }
      }
    });

    document.addEventListener('keyup', (e) => {
      if (e.key.toLowerCase() === 'e' && isAimingE) {
        isAimingE = false;
        const playerData = JSON.parse(localStorage.getItem('playerData'));
        const ability = playerData?.abilities?.[0];
        if (ability) {
          lastECastTime = Date.now();
          launchProjectile(ability);
        }
        hideAimIndicator();
      } else if (e.key.toLowerCase() === 'r' && isAimingR) {
        isAimingR = false;
        const playerData = JSON.parse(localStorage.getItem('playerData'));
        const ability = playerData?.abilities?.[1];
        if (ability) {
          lastRCastTime = Date.now();
          launchProjectile(ability);
        }
        hideAimIndicator();
      }
    });

    function showAimIndicator() {
      if (!aimIndicator) {
        aimIndicator = {
          visible: true,
          angle: 0,
          length: 100
        };
      }
      aimIndicator.visible = true;
      updateAimIndicator(event);
    }

    function hideAimIndicator() {
      if (aimIndicator) {
        aimIndicator.visible = false;
      }
    }

    function updateAimIndicator(event) {
      if (!aimIndicator || !isAimingE) return;

      const player = engine.entities.find(e => !e.isEnemy);
      if (!player) return;

      const rect = gameCanvas.getBoundingClientRect();
      const scaleX = gameCanvas.width / rect.width;
      const scaleY = gameCanvas.height / rect.height;

      const mouseX = (event.clientX - rect.left) * scaleX + engine.cameraX;
      const mouseY = (event.clientY - rect.top) * scaleY + engine.cameraY;

      const dx = mouseX - player.x;
      const dy = mouseY - player.y;
      const angle = Math.atan2(dy, dx);
      aimIndicator.angle = angle;

      // Dibujar el indicador en el canvas
      if (aimIndicator.visible) {
        const ctx = gameCanvas.getContext('2d');
        ctx.save();
        ctx.strokeStyle = 'cyan';
        ctx.fillStyle = 'cyan';
        ctx.lineWidth = 2;
        ctx.shadowColor = 'cyan';
        ctx.shadowBlur = 10;

        // Calcular el punto final de la flecha
        const startX = player.x - engine.cameraX;
        const startY = player.y - engine.cameraY;
        const endX = player.x + Math.cos(angle) * aimIndicator.length - engine.cameraX;
        const endY = player.y + Math.sin(angle) * aimIndicator.length - engine.cameraY;

        // Dibujar la l√≠nea principal
        ctx.beginPath();
        ctx.moveTo(startX, startY);
        ctx.lineTo(endX, endY);
        ctx.stroke();

        // Dibujar la punta de la flecha
        const headLength = 15;
        const headAngle = Math.PI / 6; // 30 grados

        const angle1 = angle - headAngle;
        const angle2 = angle + headAngle;

        const head1X = endX - headLength * Math.cos(angle1);
        const head1Y = endY - headLength * Math.sin(angle1);
        const head2X = endX - headLength * Math.cos(angle2);
        const head2Y = endY - headLength * Math.sin(angle2);

        ctx.beginPath();
        ctx.moveTo(endX, endY);
        ctx.lineTo(head1X, head1Y);
        ctx.lineTo(head2X, head2Y);
        ctx.closePath();
        ctx.fill();

        ctx.restore();
      }
    }

    document.addEventListener('mousemove', updateAimIndicator);

    function launchProjectile(ability) {
      const player = engine.entities.find(e => !e.isEnemy);
      if (!player) return;

      const rect = gameCanvas.getBoundingClientRect();
      const scaleX = gameCanvas.width / rect.width;
      const scaleY = gameCanvas.height / rect.height;

      const mouseX = (event.clientX - rect.left) * scaleX;
      const mouseY = (event.clientY - rect.top) * scaleY;

      const skillType = `mainproyectil_${player.class}_${isAimingE ? 'e' : 'r'}`;
      const projectile = new MainProjectile(
        player.x,
        player.y,
        mouseX + engine.cameraX,
        mouseY + engine.cameraY,
        skillType,
        ability.damage,
        player.speed
      );

      engine.addEntity(projectile);

      // Actualizar la interfaz de cooldown
      const skillKey = isAimingE ? 'e' : 'r';
      const cooldownOverlay = document.getElementById(`skill-${skillKey}-cooldown`);
      const cooldownTimer = document.getElementById(`skill-${skillType}-timer`);
      
      if (cooldownOverlay && cooldownTimer) {
        cooldownOverlay.style.transform = 'scaleY(1)';
        const startTime = Date.now();
        const cooldownDuration = ability.cooldown * 1000;

        const updateCooldown = () => {
          const currentTime = Date.now();
          const elapsed = currentTime - startTime;
          const remaining = Math.max(0, cooldownDuration - elapsed);
          const progress = remaining / cooldownDuration;

          cooldownOverlay.style.transform = `scaleY(${progress})`;
          cooldownTimer.textContent = Math.ceil(remaining / 1000);
          cooldownTimer.style.display = remaining > 0 ? 'block' : 'none';

          if (remaining > 0) {
            requestAnimationFrame(updateCooldown);
          }
        };

        updateCooldown();
      }
    }
  </script>
  <style>
    body { 
      margin: 0; 
      background: #222; 
      overflow: hidden;
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    .skill-box[data-tooltip]:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 225%;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px;
      background: rgba(0, 0, 0, 0.95);
      color: white;
      border-radius: 6px;
      font-size: 14px;
      white-space: pre;
      z-index: 999999;
      border: 1px solid rgba(255, 255, 255, 0.4);
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.7);
      line-height: 1.4;
    }
    canvas {
        image-rendering: pixelated;
        image-rendering: crisp-edges;
        width: 100vw;
        height: 100vh;
        object-fit: cover;
        position: absolute;
        z-index: 1;
    }
    #hud {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: 2;
      color: white;
      font-family: 'Mineglyph', sans-serif;
      font-size: 18px;
    }

    .stat-label {
      font-weight: bold;
      color: #ffd700;
      margin-right: 10px;
    }
    .stat-value {
      color: #fff;
    }
    .coordinates {
      font-size: 14px;
      color: #aaa;
    }
    #pauseMenu {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.8);
      z-index: 3;
      flex-direction: column;
      align-items: flex-start;
      padding-left: 30px;
    }
    #pauseMenu h1 {
      color: white;
      font-family: 'Mineglyph', sans-serif;
      font-size: 6rem;
      margin-bottom: 10px;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
      margin-top: 7%;
    }
    #pauseMenu h2 {
      color: white;
      font-size: 3rem;
      font-family: 'Mineglyph', sans-serif;
      margin-bottom: 30px;
      text-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
    }
    #settingsFrame {
      display: none;
      position: fixed;
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 10px;
      z-index: 900;
      background: #222;
    }
    .skill-card:hover {
      transform: scale(1.1);
      transition: transform 0.3s ease;
      cursor: pointer;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
    }
    .skill-card.selected {
      background: url('sprites/card_selected_sprite.png') no-repeat center !important;
      background-size: contain !important;
      transform: scale(1.1);
    }
    .menu-button {
      width: 500px;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 15px 30px;
      margin: 10px;
      border-radius: 5px;
      font-family: 'Mineglyph', sans-serif;
      font-size: 2rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .menu-button:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.5);
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="hud">
    <div id="skills-container" style="position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 20px; align-items: center;">
      <!-- Habilidades activables -->
      <div id="active-skills" style="display: flex; gap: 10px; background: rgba(0, 0, 0, 0.7); padding: 10px; border-radius: 10px;">
        <div class="skill-box" style="width: 50px; height: 50px; border: 2px solid #fff; border-radius: 5px; position: relative; overflow: visible; cursor: pointer;" data-tooltip="‚öîÔ∏è Habilidad Principal [E]&#10;üí• Da√±o: 24&#10;‚è±Ô∏è Cooldown: 3.8s&#10;üéØ Proyectiles: 1&#10;‚ùÑÔ∏è Efecto: Ralentizaci√≥n&#10;üìà Nivel: ‚óè‚óã‚óã">
          <div class="skill-icon" id="skill-e-icon" style="width: 100%; height: 100%; background-size: contain; background-repeat: no-repeat; background-position: center;"></div>
          <button class="upgrade-btn" onclick="upgradeSkill('e')" style="position: absolute; top: -10px; right: -10px; width: 20px; height: 20px; background: #ffd700; border: 1px solid #fff; border-radius: 50%; color: white; font-size: 14px; cursor: pointer; display: none; align-items: center; justify-content: center; padding: 0;">+</button>
          <div class="skill-level" style="position: absolute; top: -2px; left: 2px; font-size: 12px; color: #ffd700;">‚óè‚óã‚óã</div>
          <div class="cooldown-overlay" id="skill-e-cooldown" style="position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; background: rgb(45 45 45 / 69%); transform-origin: bottom; transform: scaleY(0); transition: transform 0.1s linear;"></div>
          <div class="key-bind" style="position: absolute; bottom: 2px; right: 2px; background: rgba(0, 0, 0, 0.7); padding: 2px 4px; border-radius: 3px; font-size: 12px; color: white;">E</div>
          <div class="cooldown-timer" id="skill-e-timer" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 16px; text-shadow: 1px 1px 2px black; display: none;"></div>
        </div>
        <div class="skill-box" style="width: 50px; height: 50px; border: 2px solid #fff; border-radius: 5px; position: relative; overflow: visible; cursor: pointer;" data-tooltip="‚öîÔ∏è Habilidad Secundaria [R]&#10;üí• Da√±o: 35&#10;‚è±Ô∏è Cooldown: 5s&#10;üéØ Proyectiles: 2&#10;üî• Efecto: Da√±o en √°rea&#10;üìà Nivel: ‚óè‚óã‚óã">
          <div class="skill-icon" id="skill-r-icon" style="width: 100%; height: 100%; background-size: contain; background-repeat: no-repeat; background-position: center;"></div>
          <button class="upgrade-btn" onclick="upgradeSkill('r')" style="position: absolute; top: -10px; right: -10px; width: 20px; height: 20px; background: #ffd700; border: 1px solid #fff; border-radius: 50%; color: white; font-size: 14px; cursor: pointer; display: none; align-items: center; justify-content: center; padding: 0;">+</button>
          <div class="skill-level" style="position: absolute; top: -2px; left: 2px; font-size: 12px; color: #ffd700;">‚óè‚óã‚óã</div>
          <div class="cooldown-overlay" id="skill-r-cooldown" style="position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; background: rgb(45 45 45 / 69%); transform-origin: bottom; transform: scaleY(0); transition: transform 0.1s linear;"></div>
          <div class="key-bind" style="position: absolute; bottom: 2px; right: 2px; background: rgba(0, 0, 0, 0.7); padding: 2px 4px; border-radius: 3px; font-size: 12px; color: white;">R</div>
          <div class="cooldown-timer" id="skill-r-timer" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 16px; text-shadow: 1px 1px 2px black; display: none;"></div>
        </div>
      </div>
      <!-- Habilidades autom√°ticas -->
      <div id="skills-bar" style="display: flex; gap: 10px; background: rgba(0, 0, 0, 0.7); padding: 10px; border-radius: 10px;">
        <div class="skill-box" style="width: 50px; height: 50px; border: 2px solid #fff; border-radius: 5px; position: relative; overflow: hidden;">
          <div class="skill-icon" id="selected-skill-icon" style="width: 100%; height: 100%; background-size: contain; background-repeat: no-repeat; background-position: center;"></div>
          <div class="cooldown-overlay" style="position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; background: rgb(45 45 45 / 69%); transform-origin: bottom; transform: scaleY(0); transition: transform 0.1s linear;"></div>
        </div>
      </div>
    </div>
    <div id="wave-info" style="position: absolute; top: 0; left: 50%; transform: translateX(-50%); text-align: center; color: white; background-color: #0c0c0ca6; width: 200px; border-radius: 0px 0px 10px 10px;">
    <div id="next-wave-timer" style="font-size: 48px; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); margin-bottom: 10px;">30s</div>
    <div id="wave-progress-container" style="width: 200px; height: 10px; background: rgba(0, 0, 0, 0.5); border-radius: 5px; overflow: hidden; margin-bottom: 10px;">
    <div id="wave-progress" style="width: 100%; height: 100%; background: #3498db; transform-origin: left; transition: transform 0.5s linear;"></div>
    </div>
    <span data-translate="wave"></span>
    <span id="wave-value">1</span>
    </div>
    
    <div class="exp-bar-container" style="position: absolute; bottom: 130px; left: 50%; transform: translateX(-50%); width: 530px; height: 10px; background: rgba(0, 0, 0, 0.7); border-radius: 5px; overflow: visible; z-index: 10;">
    <div style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%); color: white; font-size: 14px; text-shadow: 1px 1px 2px black;" id="level-display">Level 1</div>
    <div id="exp-bar" style="width: 0%; height: 100%; background: #3bc2ab; border-radius: 5px; transition: width 0.3s ease;"></div>
    </div>
    <div class="health-bar-container" style="position: absolute; bottom: 100px; left: 50%; transform: translateX(-50%); width: 530px; height: 25px; background: #222; border-radius: 5px; overflow: visible; z-index: 10;">
    <div id="health-bar-damage" style="width: 100%; height: 100%; background: #4d0707b7; border-radius: 5px; position: absolute; transition: width 0.5s ease;"></div>
    <div id="health-bar" style="width: 100%; height: 100%; background: #2ecc71; border-radius: 5px; transition: width 0.3s ease; position: relative;"></div>
    <div id="health-text" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 12px; text-shadow: 1px 1px 2px black;">100/100</div>
    </div>

    <div id="boss-health-container" style="display: none; position: absolute; top: 20px; left: 20px; width: 400px; background: rgba(0, 0, 0, 0.8); border: 2px solid #ffd700; border-radius: 5px; padding: 5px; z-index: 10;">
      <div id="boss-name" style="color: #ffd700; font-size: 18px; margin-bottom: 5px; text-align: center; text-shadow: 2px 2px 2px rgba(0, 0, 0, 0.5);">BOSS</div>
      <div style="width: 100%; height: 20px; background: #222; border-radius: 3px; overflow: hidden;">
        <div id="boss-health-bar" style="width: 100%; height: 100%; background: #ff0000; transition: width 0.3s ease;"></div>
      </div>
    </div>

    </div>

  </div>
  <div id="pauseMenu">
    <h1>LAUX GAME</h1>
    <h2 data-translate="pause"><i class="fa-solid fa-pause"></i> Pause</h2>
    <button id="resumeButton" class="menu-button" data-translate="resume">Reanudar</button>
    <button id="settingsButton" class="menu-button" data-translate="settings">Configuraci√≥n</button>
    <button id="mainMenuButton" class="menu-button" data-translate="mainMenu" onclick="window.location.href='index.html'">Men√∫ Principal</button>
    <div id="pause-version-display" style="position: fixed; bottom: 10px; left: 10px; color: rgba(255, 255, 255, 0.7); font-family: 'Mineglyph', sans-serif; font-size: 14px;"></div>
    <script type="module">
      import { VERSION } from './version.js';
      document.getElementById('pause-version-display').textContent = VERSION;
    </script>
  </div>
  <iframe id="settingsFrame" src="config.html"></iframe>
  <script>
    async function loadTranslations() {
      try {
        const response = await fetch('translations.json');
        const translations = await response.json();
        const currentLang = localStorage.getItem('language') || 'es';
        
        const elements = document.querySelectorAll('[data-translate]');
        elements.forEach(element => {
          const key = element.getAttribute('data-translate');
          if (translations[currentLang] && translations[currentLang][key]) {
            element.textContent = translations[currentLang][key];
          }
        });
      } catch (error) {
        console.error('Error loading translations:', error);
      }
    }

    // Settings frame handling
    const settingsFrame = document.getElementById('settingsFrame');
    const pauseMenu = document.getElementById('pauseMenu');
    const settingsButton = document.getElementById('settingsButton');

    settingsButton.addEventListener('click', () => {
      settingsFrame.style.display = 'block';
      pauseMenu.style.display = 'none';
      
      // Cargar configuraciones guardadas en el iframe
      const configIframe = document.getElementById('settingsFrame');
      configIframe.onload = () => {
        // Obtener todas las configuraciones del localStorage
        const brightness = localStorage.getItem('brightness') || '100';
        const showFPS = localStorage.getItem('showFPS') || 'off';
        const damageNumbers = localStorage.getItem('damageNumbers') || 'on';
        const soundVolume = localStorage.getItem('soundVolume') || '70';
        const musicVolume = localStorage.getItem('musicVolume') || '70';
        const performance = localStorage.getItem('performance') || 'off';
        const language = localStorage.getItem('language') || 'es';
        
        // Enviar todas las configuraciones al iframe para sincronizaci√≥n
        configIframe.contentWindow.postMessage({
          type: 'loadConfig',
          config: {
            brightness,
            showFPS,
            damageNumbers,
            soundVolume,
            musicVolume,
            performance,
            language
          }
        }, '*');

        // Aplicar configuraciones inmediatamente
        document.body.style.filter = `brightness(${brightness}%)`;
        const fpsContainer = document.getElementById('fps-container');
        if (fpsContainer) {
          fpsContainer.style.display = showFPS === 'on' ? 'block' : 'none';
        }
        window.damageNumbersEnabled = damageNumbers !== 'off';
        
        // Aplicar configuraci√≥n de sonido
        if (window.audioManager) {
          window.audioManager.setVolume('sound', parseInt(soundVolume) / 100);
          window.audioManager.setVolume('music', parseInt(musicVolume) / 100);
        }
        
        // Aplicar configuraci√≥n de rendimiento
        if (performance === 'on') {
          document.querySelectorAll('.skill-card').forEach(card => {
            card.style.transition = 'none';
          });
        }
      };
    });

    window.addEventListener('message', (event) => {
      if (event.data === 'closeSettings') {
        settingsFrame.style.display = 'none';
        pauseMenu.style.display = 'flex';
      }
    });

    loadTranslations();
  </script>
  <script src="assetManager.js"></script>
  <script src="map.js"></script>
  <script src="entity.js"></script>
  <script src="experienceOrb.js"></script>
  <script src="minimap.js"></script>
  <script src="engine.js"></script>
  <script src="floatingNumber.js"></script>
  <script src="proyectiles.js"></script>
  <script src="skills.js"></script>
  <script src="main.js"></script>
  <script>
    // Sistema de niveles de habilidades
let skillLevels = {
  e: 1,
  r: 1
};
let skillPoints = 0;

function updateSkillLevelDisplay(skillKey) {
  const playerData = JSON.parse(localStorage.getItem('playerData'));
  const skillIndex = skillKey === 'e' ? 0 : 1;
  const ability = playerData?.abilities?.[skillIndex];
  const skillBox = document.querySelector(`#skill-${skillKey}-icon`).parentElement;
  const upgradeBtn = skillBox.querySelector('.upgrade-btn');
  const skillLevel = skillBox.querySelector('.skill-level');
  
  if (ability && ability.level < 3) {
    upgradeBtn.style.display = 'flex';
    // Actualizar los puntos visuales seg√∫n el nivel
    const filledDots = '‚óè'.repeat(ability.level);
    const emptyDots = '‚óã'.repeat(3 - ability.level);
    skillLevel.textContent = filledDots + emptyDots;
  } else {
    upgradeBtn.style.display = 'none';
  }
}

// Escuchar evento de subida de nivel
document.addEventListener('levelUp', () => {
  skillPoints++;
  engine.isPaused = true; // Pausar el juego al subir de nivel
  // Mostrar botones de mejora si el nivel de la habilidad es menor que 3
  // Funci√≥n para actualizar la visualizaci√≥n del nivel de habilidad
  function updateSkillLevelDisplay(skillKey) {
    const playerData = JSON.parse(localStorage.getItem('playerData'));
    const skillIndex = skillKey === 'e' ? 0 : 1;
    const ability = playerData?.abilities?.[skillIndex];
    const upgradeBtn = document.querySelector(`.skill-box:nth-child(${skillIndex + 1}) .upgrade-btn`);
    const skillLevel = document.querySelector(`.skill-box:nth-child(${skillIndex + 1}) .skill-level`);
    
    if (ability && ability.level < 3) {
      upgradeBtn.style.display = 'flex';
      // Actualizar los puntos visuales seg√∫n el nivel
      const filledDots = '‚óè'.repeat(ability.level);
      const emptyDots = '‚óã'.repeat(3 - ability.level);
      skillLevel.textContent = filledDots + emptyDots;
    } else {
      upgradeBtn.style.display = 'none';
    }
  }
  
  // Actualizar la visualizaci√≥n para ambas habilidades
  updateSkillLevelDisplay('e');
  updateSkillLevelDisplay('r');
});

// Funci√≥n para mejorar una habilidad
function upgradeSkill(skillKey) {
  if (skillPoints > 0) {
    const playerData = JSON.parse(localStorage.getItem('playerData'));
    const skillIndex = skillKey === 'e' ? 0 : 1;
    const ability = playerData.abilities[skillIndex];
    
    if (ability.level < 3) {
      ability.level++;
      ability.damage += 10; // Aumentar el da√±o
      ability.cooldown *= 0.9; // Reducir el tiempo de cooldown
      skillPoints--;
      
      localStorage.setItem('playerData', JSON.stringify(playerData));
      updateSkillLevelDisplay(skillKey);
      
      // Si no quedan puntos de habilidad, reanudar el juego
      if (skillPoints === 0) {
        engine.isPaused = false;
      }
    }
  }
}

// Escuchar cuando se reanuda el juego para ocultar los botones
document.addEventListener('resumeGame', () => {
  engine.isPaused = false;
  document.querySelectorAll('.upgrade-btn').forEach(btn => btn.style.display = 'none');
});

// Inicializar los displays de nivel
document.addEventListener('DOMContentLoaded', () => {
  updateSkillLevelDisplay('e');
  updateSkillLevelDisplay('r');
});


document.addEventListener('DOMContentLoaded', () => {
      // Funci√≥n para actualizar la barra de vida y mostrar el da√±o
      window.updateHealthBar = function(currentHealth, maxHealth) {
        const healthBar = document.getElementById('health-bar');
        const healthBarDamage = document.getElementById('health-bar-damage');
        const healthText = document.getElementById('health-text');
        
        const healthPercent = (currentHealth / maxHealth) * 100;
        healthBar.style.width = healthPercent + '%';
        healthText.textContent = `${Math.ceil(currentHealth)}/${maxHealth}`;
        
        // Mostrar el da√±o en rojo
        healthBarDamage.style.width = healthPercent + '%';
        healthBarDamage.style.transition = 'width 0.3s ease';
      };

      // Actualizar tooltips de habilidades con datos del jugador
      function updateSkillTooltips() {
        const playerData = JSON.parse(localStorage.getItem('playerData'));
        const abilities = playerData?.abilities;
        if (!abilities) return;

        const skillE = document.querySelector('#active-skills .skill-box:first-child');
        const skillR = document.querySelector('#active-skills .skill-box:last-child');

        if (skillE && abilities[0]) {
          skillE.setAttribute('data-tooltip', 
            `‚öîÔ∏è Habilidad Principal [E]\n` +
            `üí• Da√±o: ${abilities[0].damage}\n` +
            `‚è±Ô∏è Cooldown: ${abilities[0].cooldown}s\n` +
            `üéØ Proyectiles: ${abilities[0].projectiles || 1}\n` +
            `‚ùÑÔ∏è Efecto: ${abilities[0].effect || 'Ralentizaci√≥n'}`
          );
        }

        if (skillR && abilities[1]) {
          skillR.setAttribute('data-tooltip', 
            `‚öîÔ∏è Habilidad Secundaria [R]\n` +
            `üí• Da√±o: ${abilities[1].damage}\n` +
            `‚è±Ô∏è Cooldown: ${abilities[1].cooldown}s\n` +
            `üéØ Proyectiles: ${abilities[1].projectiles || 2}\n` +
            `üî• Efecto: ${abilities[1].effect || 'Da√±o en √°rea'}`
          );
        }
      }

      // Actualizar tooltips inicialmente y cuando cambien los datos del jugador
      updateSkillTooltips();
      window.addEventListener('playerDataUpdated', updateSkillTooltips);
    });
  </script>
</body>
</html>